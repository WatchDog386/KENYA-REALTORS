# ğŸ”„ Unified Registration & Approval System - Architecture Diagram

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        REGISTRATION SYSTEM                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  USER FLOW:                                                             â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ Property Manager â”‚         â”‚     Tenant       â”‚                    â”‚
â”‚  â”‚  Registration    â”‚         â”‚  Registration    â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚           â”‚                            â”‚                              â”‚
â”‚           â”‚ [Select Properties]        â”‚ [Select Property + Unit]    â”‚
â”‚           â”‚                            â”‚                              â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                        â–¼                                              â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚            â”‚  Create Auth User    â”‚                                  â”‚
â”‚            â”‚   + Metadata         â”‚                                  â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                       â–¼                                              â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚          â”‚ Create Profile Record  â”‚                                 â”‚
â”‚          â”‚  status='pending'      â”‚                                 â”‚
â”‚          â”‚  is_active=false       â”‚                                 â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                       â–¼                                              â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚       â”‚ Create Approval Record:     â”‚                               â”‚
â”‚       â”‚ manager_approvals OR        â”‚                               â”‚
â”‚       â”‚ tenant_approvals            â”‚                               â”‚
â”‚       â”‚ status='pending'            â”‚                               â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                    â–¼                                                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚       â”‚ Send Notification to     â”‚                                 â”‚
â”‚       â”‚ All Super Admins         â”‚                                 â”‚
â”‚       â”‚ "New approval pending"   â”‚                                 â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                                     â”‚
â”‚  RESULT: User can't login (status='pending')                        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Super Admin Approval Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SUPER ADMIN DASHBOARD                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  USER MANAGEMENT                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Filter: [â³ Pending Approval â–¼]                                â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚ â”‚ Name    â”‚ Email    â”‚ Role   â”‚ Status       â”‚ Action      â”‚  â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚
â”‚  â”‚ â”‚ John M  â”‚ j@ex.com â”‚ None   â”‚ â³ Pending   â”‚ [ğŸ‘¤] [ğŸ—‘]  â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ Jane T  â”‚ j@ex.com â”‚ None   â”‚ â³ Pending   â”‚ [ğŸ‘¤] [ğŸ—‘]  â”‚  â”‚  â”‚
â”‚  â”‚ â”‚ Bob P   â”‚ b@ex.com â”‚ None   â”‚ â³ Pending   â”‚ [ğŸ‘¤] [ğŸ—‘]  â”‚  â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚ CLICK [ğŸ‘¤] ON ROW:                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚  â”‚
â”‚  â”‚  â”‚ ASSIGN ROLE & APPROVE            â”‚                          â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚  â”‚
â”‚  â”‚  â”‚ Name: John Manager               â”‚                          â”‚  â”‚
â”‚  â”‚  â”‚ Email: john@example.com          â”‚                          â”‚  â”‚
â”‚  â”‚  â”‚ Current Role: None               â”‚                          â”‚  â”‚
â”‚  â”‚  â”‚ Status: â³ Pending Approval      â”‚                          â”‚  â”‚
â”‚  â”‚  â”‚                                  â”‚                          â”‚  â”‚
â”‚  â”‚  â”‚ Assign Role & Approve *          â”‚                          â”‚  â”‚
â”‚  â”‚  â”‚ [âœ“ Property Manager â–¼]          â”‚                          â”‚  â”‚
â”‚  â”‚  â”‚                                  â”‚                          â”‚  â”‚
â”‚  â”‚  â”‚ â„¹ï¸ Selecting a role will:        â”‚                          â”‚  â”‚
â”‚  â”‚  â”‚   - Approve this user            â”‚                          â”‚  â”‚
â”‚  â”‚  â”‚   - Activate their account       â”‚                          â”‚  â”‚
â”‚  â”‚  â”‚   - Send them a notification     â”‚                          â”‚  â”‚
â”‚  â”‚  â”‚                                  â”‚                          â”‚  â”‚
â”‚  â”‚  â”‚ [Cancel] [âœ“ Approve & Assign]   â”‚                          â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚ AFTER CLICK:                                                    â”‚  â”‚
â”‚  â”‚ â”œâ”€ profiles.status = 'active' âœ“                               â”‚  â”‚
â”‚  â”‚ â”œâ”€ profiles.is_active = true âœ“                                â”‚  â”‚
â”‚  â”‚ â”œâ”€ manager_approvals.status = 'approved' âœ“                    â”‚  â”‚
â”‚  â”‚ â”œâ”€ Send notification: "Account approved!" âœ“                   â”‚  â”‚
â”‚  â”‚ â””â”€ User can now login âœ“                                       â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Login with Approval Check Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LOGIN PAGE                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  User enters: Email + Password                                          â”‚
â”‚              â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚ Verify Credentials     â”‚                                            â”‚
â”‚  â”‚ (Supabase Auth)        â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚               â–¼                                                        â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚          â”‚ Valid Creds?   â”‚                                           â”‚
â”‚          â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜                                           â”‚
â”‚            NO         YES                                             â”‚
â”‚             â”‚          â”‚                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚     â–¼                             â–¼                                  â”‚
â”‚  âŒ Error                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚     "Invalid              â”‚ Check Status:    â”‚                     â”‚
â”‚      Credentials"         â”‚ SELECT status    â”‚                     â”‚
â”‚                           â”‚ FROM profiles    â”‚                     â”‚
â”‚                           â”‚ WHERE id=user_id â”‚                     â”‚
â”‚                           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                     â”‚
â”‚                               â”‚        â”‚                          â”‚
â”‚                        pending â”‚        â”‚ active                  â”‚
â”‚                               â–¼        â–¼                          â”‚
â”‚                        âŒ ERROR    âœ… LOGIN OK                     â”‚
â”‚                        "Your      â”œâ”€ Redirect by role:             â”‚
â”‚                         account  â”‚  â”œâ”€ property_manager            â”‚
â”‚                         pending"  â”‚  â”‚  â†’ /portal/manager          â”‚
â”‚                        Sign OUT   â”‚  â”œâ”€ tenant                     â”‚
â”‚                                   â”‚  â”‚  â†’ /portal/tenant           â”‚
â”‚                                   â”‚  â””â”€ super_admin                â”‚
â”‚                                   â”‚     â†’ /portal/super-admin      â”‚
â”‚                                   â”‚                                â”‚
â”‚                                   â””â”€ User logged in âœ“             â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Database Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DATABASE SCHEMA                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  auth.users (Supabase)                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚ id (UUID) [PK]          â”‚                                            â”‚
â”‚  â”‚ email (TEXT)            â”‚                                            â”‚
â”‚  â”‚ raw_user_meta_data      â”‚ â† Contains: role, first_name, etc.        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚               â”‚ 1:1                                                     â”‚
â”‚               â”‚                                                         â”‚
â”‚               â–¼                                                         â”‚
â”‚  public.profiles                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚ id (UUID) [FK] [PK]             â”‚                                   â”‚
â”‚  â”‚ email (TEXT)                    â”‚                                   â”‚
â”‚  â”‚ first_name, last_name           â”‚                                   â”‚
â”‚  â”‚ role (TEXT) â† Key field!        â”‚                                   â”‚
â”‚  â”‚ status (TEXT)                   â”‚ â† pending | active | suspended   â”‚
â”‚  â”‚ is_active (BOOLEAN)             â”‚ â† Can they login?               â”‚
â”‚  â”‚ approved_by (UUID) [FKâ†’users]   â”‚                                   â”‚
â”‚  â”‚ approved_at (TIMESTAMP)         â”‚                                   â”‚
â”‚  â”‚ property_id (UUID) [FK]         â”‚ â† For tenants                   â”‚
â”‚  â”‚ unit_id (UUID) [FK]             â”‚ â† For tenants                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚           â”‚              â”‚                                              â”‚
â”‚        1:1 â”‚              â”‚ 1:1                                          â”‚
â”‚           â”‚              â”‚                                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚    â”‚         â”‚    â”‚                  â”‚                                 â”‚
â”‚    â–¼         â–¼    â–¼                  â–¼                                 â”‚
â”‚  manager_   tenant_            [properties]                             â”‚
â”‚  approvals  approvals          [units_detailed]                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”                                                    â”‚
â”‚  â”‚ id  â”‚    â”‚ id  â”‚                                                    â”‚
â”‚  â”‚uid  â”‚    â”‚uid  â”‚                                                    â”‚
â”‚  â”‚pid  â”‚    â”‚pid  â”‚                                                    â”‚
â”‚  â”‚statâ”‚    â”‚statâ”‚                                                    â”‚
â”‚  â”‚propâ”‚    â”‚uid â”‚                                                    â”‚
â”‚  â”‚     â”‚    â”‚    â”‚                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚                                                                        â”‚
â”‚  notifications                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚  â”‚ id (UUID) [PK]           â”‚                                          â”‚
â”‚  â”‚ recipient_id (UUID) [FK] â”‚ â† Notified user                          â”‚
â”‚  â”‚ type (TEXT)              â”‚ â† manager_approval, approval_granted    â”‚
â”‚  â”‚ title (VARCHAR)          â”‚                                          â”‚
â”‚  â”‚ message (TEXT)           â”‚                                          â”‚
â”‚  â”‚ is_read (BOOLEAN)        â”‚                                          â”‚
â”‚  â”‚ created_at (TIMESTAMP)   â”‚                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## RLS (Row Level Security) Policies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHO CAN ACCESS WHAT?                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  profiles TABLE:                                                    â”‚
â”‚  â”œâ”€ service_role (Auth trigger): âœ“ FULL ACCESS                     â”‚
â”‚  â”œâ”€ authenticated user: âœ“ View own / âœ“ Update own                  â”‚
â”‚  â””â”€ super_admin: âœ“ FULL ACCESS                                     â”‚
â”‚                                                                      â”‚
â”‚  manager_approvals TABLE:                                           â”‚
â”‚  â”œâ”€ service_role: âœ“ FULL ACCESS                                    â”‚
â”‚  â”œâ”€ super_admin: âœ“ FULL ACCESS                                     â”‚
â”‚  â””â”€ authenticated user: âœ“ View own                                  â”‚
â”‚                                                                      â”‚
â”‚  tenant_approvals TABLE:                                            â”‚
â”‚  â”œâ”€ service_role: âœ“ FULL ACCESS                                    â”‚
â”‚  â”œâ”€ super_admin: âœ“ FULL ACCESS                                     â”‚
â”‚  â””â”€ authenticated user: âœ“ View own                                  â”‚
â”‚                                                                      â”‚
â”‚  notifications TABLE:                                               â”‚
â”‚  â”œâ”€ service_role: âœ“ FULL ACCESS                                    â”‚
â”‚  â”œâ”€ authenticated user: âœ“ View own / âœ“ Mark as read               â”‚
â”‚  â””â”€ super_admin: âœ“ FULL ACCESS                                     â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Status Transitions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  USER STATUS LIFECYCLE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  REGISTRATION:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ New User   â”‚â”€â”€â”€â”€â”€â–¶â”‚  PENDING   â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚  ACTIVE  â”‚            â”‚
â”‚  â”‚ Registered â”‚  S1  â”‚ (Can't     â”‚  S2   â”‚ (Can     â”‚            â”‚
â”‚  â”‚            â”‚      â”‚  login)    â”‚       â”‚  login)  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚        â–²                                         â”‚                 â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                      â”‚
â”‚  S1 = Registration complete (status='pending', is_active=false)    â”‚
â”‚  S2 = Admin approval (status='active', is_active=true)             â”‚
â”‚                                                                      â”‚
â”‚  OPTIONAL:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Admin suspension  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  ACTIVE  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ SUSPENDED â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                      â”‚
â”‚  REJECTION (future feature):                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Admin rejects  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  PENDING   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ REJECTED     â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ (Can        â”‚                   â”‚
â”‚                                  â”‚  re-apply)  â”‚                   â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## API/Function Calls

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  KEY FUNCTIONS CALLED                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  REGISTRATION:                                                      â”‚
â”‚  1. supabase.auth.signUp()                                          â”‚
â”‚     â””â”€ Creates auth user                                            â”‚
â”‚                                                                      â”‚
â”‚  2. supabase.from('profiles').upsert()                              â”‚
â”‚     â””â”€ Creates profile record (via auth trigger, or direct)         â”‚
â”‚                                                                      â”‚
â”‚  3. supabase.from('manager_approvals').insert()                     â”‚
â”‚     â””â”€ Creates approval record (property managers only)             â”‚
â”‚                                                                      â”‚
â”‚  4. supabase.from('tenant_approvals').insert()                      â”‚
â”‚     â””â”€ Creates approval record (tenants only)                       â”‚
â”‚                                                                      â”‚
â”‚  5. supabase.from('notifications').insert()                         â”‚
â”‚     â””â”€ Notifies super admins                                        â”‚
â”‚                                                                      â”‚
â”‚  LOGIN:                                                             â”‚
â”‚  1. supabase.auth.signInWithPassword()                              â”‚
â”‚     â””â”€ Authenticates user                                           â”‚
â”‚                                                                      â”‚
â”‚  2. supabase.from('profiles').select('status')                      â”‚
â”‚     â””â”€ Checks if approved                                           â”‚
â”‚                                                                      â”‚
â”‚  3. [If pending] supabase.auth.signOut()                            â”‚
â”‚     â””â”€ Logs out unapproved user                                     â”‚
â”‚                                                                      â”‚
â”‚  APPROVAL:                                                          â”‚
â”‚  1. supabase.from('profiles').update()                              â”‚
â”‚     â””â”€ Set status='active', is_active=true                          â”‚
â”‚                                                                      â”‚
â”‚  2. supabase.from('manager_approvals').update()                     â”‚
â”‚     â””â”€ Set status='approved'                                        â”‚
â”‚                                                                      â”‚
â”‚  3. supabase.from('notifications').insert()                         â”‚
â”‚     â””â”€ Notify user of approval                                      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Last Updated: February 4, 2026**
